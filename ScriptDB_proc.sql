IF DB_ID ('QLTH') IS NOT NULL
	DROP DATABASE QLTH

CREATE DATABASE QLTH
USE QLTH
GO


CREATE TABLE NHANVIEN (
	MANV VARCHAR(50) NOT NULL,
	TENNV NVARCHAR(50) NOT NULL,
	LUONG_NV MONEY NOT NULL,
	DOB_NV DATE NOT NULL,
	DIACHI_NV NVARCHAR(100) NOT NULL,
	CHUCVU_NV NVARCHAR(50) NOT NULL,
	SDT_NV VARCHAR(10) NOT NULL,
	USERNAME_NV NVARCHAR(50),

	CONSTRAINT PK_NV
	PRIMARY KEY (MANV)
)

CREATE TABLE GIAOVIEN (
	MAGV VARCHAR(50) NOT NULL,
	TENGV NVARCHAR(50) NOT NULL,
	LUONG_GV MONEY NOT NULL,
	DOB_NV DATE NOT NULL,
	DIACHI_GV NVARCHAR(100) NOT NULL,
	SDT_GV VARCHAR(10) NOT NULL,
	CHUYENMON_GV NVARCHAR(50) NOT NULL,
	HOCVI_GV NVARCHAR(20) NOT NULL,
	USERNAME_GV NVARCHAR(50),
	

	CONSTRAINT PK_GV
	PRIMARY KEY (MAGV)
)

CREATE TABLE CT_DAOTAO (
	MA_CTDT VARCHAR(50),
	TEN_CTDT NVARCHAR(50) NOT NULL,
	THOIGIAN_KHAIGIANG DATE NOT NULL

	CONSTRAINT PK_CTDT
	PRIMARY KEY (MA_CTDT)
)
CREATE TABLE HOCVIEN (
	MAHV VARCHAR(50) NOT NULL,
	TENHV NVARCHAR(50) NOT NULL,
	DOB_HV DATE NOT NULL,
	DIACHI_HV NVARCHAR(100) NOT NULL,
	SDT_HV VARCHAR(50) NOT NULL,
	USERNAME_HV NVARCHAR(50),

	CONSTRAINT PK_HV
	PRIMARY KEY (MAHV)
)

CREATE TABLE BANGTOTNGHIEP (
	MABANG VARCHAR(50) NOT NULL,
	NGAYTOTNGHIEP DATE NOT NULL,
	LOAITN NVARCHAR(10) NOT NULL,
	MACTDT VARCHAR(50) NOT NULL,
	MAHV VARCHAR(50) NOT NULL

	CONSTRAINT PK_TN
	PRIMARY KEY (MABANG)
)

CREATE TABLE GHIDANH (
	MACTDT VARCHAR(50) NOT NULL,
	MAHV VARCHAR(50) NOT NULL,
	NGAYGHIDANH DATE NOT NULL

	CONSTRAINT PK_GD
	PRIMARY KEY (MACTDT, MAHV)
)

CREATE TABLE LICHTHI_TOTNGHIEP (
	MACTDT VARCHAR(50) NOT NULL,
	NGAYTHI_TN DATE NOT NULL,
	PHONGTHI_TN VARCHAR(10) NOT NULL,
	CATHI_TN NVARCHAR(50) NOT NULL

	CONSTRAINT PK_LT_TN
	PRIMARY KEY (MACTDT, NGAYTHI_TN, CATHI_TN, PHONGTHI_TN)
)

CREATE TABLE DANHSACHTHI_TN (
	MACTDT VARCHAR(50) NOT NULL,
	NGAYTHI_TN DATE NOT NULL,
	CATHI_TN NVARCHAR(50) NOT NULL,
	PHONGTHI_TN VARCHAR(10) NOT NULL,
	MAHV VARCHAR(50) NOT NULL,
	DIEMTHI_TN FLOAT NOT NULL

	CONSTRAINT PK_DS_TN
	PRIMARY KEY (MACTDT, NGAYTHI_TN, CATHI_TN, PHONGTHI_TN,MAHV)
)

CREATE TABLE MONHOC (
	MAMH VARCHAR(50) NOT NULL,
	TENMONHOC NVARCHAR(50) NOT NULL,
	HOCPHI MONEY NOT NULL,
	LOAI_MH NVARCHAR(20) NOT NULL

	CONSTRAINT PK_MH
	PRIMARY KEY (MAMH)
)

CREATE TABLE NHOMHOCPHAN (
	MANHOMHP VARCHAR(50) NOT NULL,
	TENNHOM_HP NVARCHAR(50) NOT NULL

	CONSTRAINT PK_HP
	PRIMARY KEY (MANHOMHP)
)

CREATE TABLE CHITIET_NHOMHP (
	MAHP VARCHAR(50) NOT NULL,
	MAMH VARCHAR(50) NOT NULL

	CONSTRAINT PK_CT_HP
	PRIMARY KEY (MAHP, MAMH)
)

CREATE TABLE LOPHOC (
	MALOP VARCHAR(50) NOT NULL,
	NGAYBATDAU DATE NOT NULL,
	NGAYKETTHUC DATE NOT NULL,
	PHONGHOC VARCHAR(10) NOT NULL,
	LICH_HOC NVARCHAR(50) NOT NULL,
	SISO_TOIDA INT NOT NULL,
	SISO INT NOT NULL,
	MAMH VARCHAR(50) NOT NULL,

	CONSTRAINT PK_LH
	PRIMARY KEY (MALOP)
)

CREATE TABLE PHANCONGDAY (
	MALOP VARCHAR(50),
	MAGV VARCHAR(50)

	CONSTRAINT PK_DAY
	PRIMARY KEY (MALOP, MAGV)
)

CREATE TABLE PHIEUDANGKY_LOPHOC (
	MAPHIEUDANGKY VARCHAR(50) NOT NULL,
	NGAYDANGKY_LOPHOC DATE NOT NULL,
	MAHV VARCHAR(50) NOT NULL

	CONSTRAINT PK_PDKLH
	PRIMARY KEY (MAPHIEUDANGKY)
)

CREATE TABLE CHITIET_DANGKYLOPHOC (
	MALOPHOC VARCHAR(50) NOT NULL,
	MAPHIEUDANKY_LOPHOC VARCHAR(50) NOT NULL,
	KETQUAMONHOC BIT 

	CONSTRAINT PK_CTDK
	PRIMARY KEY (MALOPHOC,MAPHIEUDANKY_LOPHOC)
)

CREATE TABLE HOADON (
	NGAYLAPHOADON DATE NOT NULL,
	MAPHIEUDANGKY_LOPHOC VARCHAR(50) NOT NULL,
	TONGTIEN MONEY NOT NULL,
	MANV VARCHAR(50) NOT NULL

	CONSTRAINT PK_HD
	PRIMARY KEY (MAPHIEUDANGKY_LOPHOC)
)

CREATE TABLE GIAYCHUNGNHAN (
	MAGCN VARCHAR(50) NOT NULL,
	TENGCN NVARCHAR(50) NOT NULL,
	MAHP VARCHAR(50) NOT NULL,
	MAHV VARCHAR(50) NOT NULL

	CONSTRAINT PK_GCN
	PRIMARY KEY (MAGCN)
)

CREATE TABLE LICHTHI_THILAI (
	MAMH VARCHAR(50) NOT NULL,
	NGAYTHILAI DATE,
	PHONGTHILAI VARCHAR(10),
	CATHILAI NVARCHAR(50),

	CONSTRAINT PK_TL
	PRIMARY KEY (MAMH,NGAYTHILAI,CATHILAI, PHONGTHILAI)
)

CREATE TABLE DANHSACH_THILAI (
	MAMH VARCHAR(50) NOT NULL,
	NGAYTHILAI DATE,
	MAHV VARCHAR(50),
	CATHILAI NVARCHAR(50),
	DIEMTHILAI FLOAT,
	PHONGTHILAI VARCHAR(10)

	CONSTRAINT PK_DS_TL
	PRIMARY KEY (MAMH,NGAYTHILAI,CATHILAI, PHONGTHILAI, MAHV)
)

CREATE TABLE LICHTHI_MONHOC (
	MALOPHOC VARCHAR(50) NOT NULL,
	PHANLOAI VARCHAR(20) NOT NULL,
	NGAYTHI_MONHOC DATE,
	PHONGTHI_MONHOC VARCHAR(10),
	CATHI_MONHOC NVARCHAR(30),

	CONSTRAINT PK_THI_MH
	PRIMARY KEY (MALOPHOC,PHANLOAI)
)

CREATE TABLE DANHSACHTHI_MONHOC (
	MALOPHOC VARCHAR(50),
	PHANLOAI VARCHAR(20),
	MAHV VARCHAR(50),
	DIEMTHI_MH FLOAT

	CONSTRAINT PK_DS_MH
	PRIMARY KEY (MALOPHOC,PHANLOAI,MAHV)
)

CREATE TABLE DANHSACH_GACTHI (
	NGAYTHI DATE,
	PHONGTHI VARCHAR(20),
	CATHI NVARCHAR(50),
	MANV VARCHAR(50)

	CONSTRAINT PK_DS_GACTHI
	PRIMARY KEY (NGAYTHI, PHONGTHI, CATHI, MANV)
)

CREATE TABLE USERS (
	USERNAME VARCHAR(20) NOT NULL,
	PASSWORD VARCHAR(20) NOT NULL,
	TYPE VARCHAR(20)
)

USE [QLTH]
GO


GO
INSERT [dbo].[CHITIET_DANGKYLOPHOC] ([MALOPHOC], [MAPHIEUDANKY_LOPHOC], [KETQUAMONHOC]) VALUES (N'LH01', N'PDK06', 0)
INSERT [dbo].[CHITIET_DANGKYLOPHOC] ([MALOPHOC], [MAPHIEUDANKY_LOPHOC], [KETQUAMONHOC]) VALUES (N'LH02', N'PDK03', 0)
INSERT [dbo].[CHITIET_DANGKYLOPHOC] ([MALOPHOC], [MAPHIEUDANKY_LOPHOC], [KETQUAMONHOC]) VALUES (N'LH03', N'PDK03', 0)
INSERT [dbo].[CHITIET_DANGKYLOPHOC] ([MALOPHOC], [MAPHIEUDANKY_LOPHOC], [KETQUAMONHOC]) VALUES (N'LH04', N'PDK05', 1)
INSERT [dbo].[CHITIET_DANGKYLOPHOC] ([MALOPHOC], [MAPHIEUDANKY_LOPHOC], [KETQUAMONHOC]) VALUES (N'LH05', N'PDK05', 1)
GO
INSERT [dbo].[CHITIET_NHOMHP] ([MAHP], [MAMH]) VALUES (N'HP01', N'MH02')
INSERT [dbo].[CHITIET_NHOMHP] ([MAHP], [MAMH]) VALUES (N'HP01', N'MH04')
INSERT [dbo].[CHITIET_NHOMHP] ([MAHP], [MAMH]) VALUES (N'HP01', N'MH09')
INSERT [dbo].[CHITIET_NHOMHP] ([MAHP], [MAMH]) VALUES (N'HP02', N'MH05')
INSERT [dbo].[CHITIET_NHOMHP] ([MAHP], [MAMH]) VALUES (N'HP02', N'MH06')
INSERT [dbo].[CHITIET_NHOMHP] ([MAHP], [MAMH]) VALUES (N'HP03', N'MH02')
INSERT [dbo].[CHITIET_NHOMHP] ([MAHP], [MAMH]) VALUES (N'HP03', N'MH07')
GO
INSERT [dbo].[CT_DAOTAO] ([MA_CTDT], [TEN_CTDT], [THOIGIAN_KHAIGIANG]) VALUES (N'CCA21', N'CCA21', CAST(N'2021-06-08' AS Date))
INSERT [dbo].[CT_DAOTAO] ([MA_CTDT], [TEN_CTDT], [THOIGIAN_KHAIGIANG]) VALUES (N'CCB21', N'CCB21', CAST(N'2021-05-20' AS Date))
INSERT [dbo].[CT_DAOTAO] ([MA_CTDT], [TEN_CTDT], [THOIGIAN_KHAIGIANG]) VALUES (N'CD1_21', N'CD1_21', CAST(N'2021-03-29' AS Date))
INSERT [dbo].[CT_DAOTAO] ([MA_CTDT], [TEN_CTDT], [THOIGIAN_KHAIGIANG]) VALUES (N'KTV21', N'KTV21', CAST(N'2021-04-17' AS Date))
GO
INSERT [dbo].[DANHSACH_THILAI] ([MAMH], [NGAYTHILAI], [MAHV], [CATHILAI], [DIEMTHILAI], [PHONGTHILAI]) VALUES (N'MH04', CAST(N'2021-07-09' AS Date), N'HV05', N'Ca 1', 0, N'F203')
INSERT [dbo].[DANHSACH_THILAI] ([MAMH], [NGAYTHILAI], [MAHV], [CATHILAI], [DIEMTHILAI], [PHONGTHILAI]) VALUES (N'MH05', CAST(N'2021-07-19' AS Date), N'HV04', N'Ca 1', 0, N'C306')
INSERT [dbo].[DANHSACH_THILAI] ([MAMH], [NGAYTHILAI], [MAHV], [CATHILAI], [DIEMTHILAI], [PHONGTHILAI]) VALUES (N'MH06', CAST(N'2021-07-09' AS Date), N'HV02', N'Ca 1', 0, N'F203')
INSERT [dbo].[DANHSACH_THILAI] ([MAMH], [NGAYTHILAI], [MAHV], [CATHILAI], [DIEMTHILAI], [PHONGTHILAI]) VALUES (N'MH07', CAST(N'2021-07-19' AS Date), N'HV03', N'Ca 1', 0, N'C306')
INSERT [dbo].[DANHSACH_THILAI] ([MAMH], [NGAYTHILAI], [MAHV], [CATHILAI], [DIEMTHILAI], [PHONGTHILAI]) VALUES (N'MH08', CAST(N'2021-07-27' AS Date), N'HV01', N'Ca 2', 0, N'D107')
INSERT [dbo].[DANHSACH_THILAI] ([MAMH], [NGAYTHILAI], [MAHV], [CATHILAI], [DIEMTHILAI], [PHONGTHILAI]) VALUES (N'MH09', CAST(N'2021-07-27' AS Date), N'HV05', N'Ca 2', 0, N'D107')
GO
INSERT [dbo].[DANHSACHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [MAHV], [DIEMTHI_MH]) VALUES (N'LH01', N'CK', N'HV01', 0)
INSERT [dbo].[DANHSACHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [MAHV], [DIEMTHI_MH]) VALUES (N'LH02', N'GK', N'HV02', 0)
INSERT [dbo].[DANHSACHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [MAHV], [DIEMTHI_MH]) VALUES (N'LH03', N'CK', N'HV03', 0)
INSERT [dbo].[DANHSACHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [MAHV], [DIEMTHI_MH]) VALUES (N'LH04', N'CK', N'HV04', 0)
INSERT [dbo].[DANHSACHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [MAHV], [DIEMTHI_MH]) VALUES (N'LH05', N'GK', N'HV05', 0)
GO
INSERT [dbo].[DANHSACHTHI_TN] ([MACTDT], [NGAYTHI_TN], [CATHI_TN], [PHONGTHI_TN], [MAHV], [DIEMTHI_TN]) VALUES (N'CCA21', CAST(N'2022-11-03' AS Date), N'Ca 2', N'F106', N'HV01', 0)
INSERT [dbo].[DANHSACHTHI_TN] ([MACTDT], [NGAYTHI_TN], [CATHI_TN], [PHONGTHI_TN], [MAHV], [DIEMTHI_TN]) VALUES (N'CCB21', CAST(N'2022-07-16' AS Date), N'Ca 1', N'D302', N'HV01', 0)
INSERT [dbo].[DANHSACHTHI_TN] ([MACTDT], [NGAYTHI_TN], [CATHI_TN], [PHONGTHI_TN], [MAHV], [DIEMTHI_TN]) VALUES (N'CCB21', CAST(N'2022-07-16' AS Date), N'Ca 1', N'D302', N'HV02', 0)
INSERT [dbo].[DANHSACHTHI_TN] ([MACTDT], [NGAYTHI_TN], [CATHI_TN], [PHONGTHI_TN], [MAHV], [DIEMTHI_TN]) VALUES (N'CD1_21', CAST(N'2022-07-16' AS Date), N'Ca 1', N'D302', N'HV05', 0)
INSERT [dbo].[DANHSACHTHI_TN] ([MACTDT], [NGAYTHI_TN], [CATHI_TN], [PHONGTHI_TN], [MAHV], [DIEMTHI_TN]) VALUES (N'KTV21', CAST(N'2022-11-03' AS Date), N'Ca 2', N'F106', N'HV03', 0)
INSERT [dbo].[DANHSACHTHI_TN] ([MACTDT], [NGAYTHI_TN], [CATHI_TN], [PHONGTHI_TN], [MAHV], [DIEMTHI_TN]) VALUES (N'KTV21', CAST(N'2022-11-03' AS Date), N'Ca 2', N'F106', N'HV04', 0)
GO
INSERT [dbo].[GHIDANH] ([MACTDT], [MAHV], [NGAYGHIDANH]) VALUES (N'KTV21', N'HV01', CAST(N'2021-08-08' AS Date))
INSERT [dbo].[GHIDANH] ([MACTDT], [MAHV], [NGAYGHIDANH]) VALUES (N'KTV21', N'HV02', CAST(N'2021-08-07' AS Date))
INSERT [dbo].[GHIDANH] ([MACTDT], [MAHV], [NGAYGHIDANH]) VALUES (N'KTV21', N'HV04', CAST(N'2021-06-08' AS Date))
GO
INSERT [dbo].[GIAOVIEN] ([MAGV], [TENGV], [LUONG_GV], [DOB_NV], [DIACHI_GV], [SDT_GV], [CHUYENMON_GV], [HOCVI_GV], [USERNAME_GV]) VALUES (N'GV01', N'Kathy Fuller', 2771.1579, CAST(N'2000-11-20' AS Date), N'515 Milton Blvd.', N'417', N'HTTT', N'ĐH', N'')
INSERT [dbo].[GIAOVIEN] ([MAGV], [TENGV], [LUONG_GV], [DOB_NV], [DIACHI_GV], [SDT_GV], [CHUYENMON_GV], [HOCVI_GV], [USERNAME_GV]) VALUES (N'GV02', N'Leon Mueller', 1300.3813, CAST(N'1979-03-27' AS Date), N'13 Hague Road', N'4', N'CNPM', N'TS', N'')
INSERT [dbo].[GIAOVIEN] ([MAGV], [TENGV], [LUONG_GV], [DOB_NV], [DIACHI_GV], [SDT_GV], [CHUYENMON_GV], [HOCVI_GV], [USERNAME_GV]) VALUES (N'GV03', N'Erick Edwards', 1006.3292, CAST(N'1984-07-01' AS Date), N'10 West Green Oak Road', N'74', N'KHMT', N'Ths', N'')
INSERT [dbo].[GIAOVIEN] ([MAGV], [TENGV], [LUONG_GV], [DOB_NV], [DIACHI_GV], [SDT_GV], [CHUYENMON_GV], [HOCVI_GV], [USERNAME_GV]) VALUES (N'GV04', N'Shari Brewer', 1157.2756, CAST(N'1993-08-17' AS Date), N'252 Old St.', N'75', N'KHMT', N'Ths', N'')
INSERT [dbo].[GIAOVIEN] ([MAGV], [TENGV], [LUONG_GV], [DOB_NV], [DIACHI_GV], [SDT_GV], [CHUYENMON_GV], [HOCVI_GV], [USERNAME_GV]) VALUES (N'GV05', N'Bart Krueger', 3200.5692, CAST(N'1996-12-29' AS Date), N'61 Hague Drive', N'74', N'HTTT', N'ĐH', N'')
GO
INSERT [dbo].[HOADON] ([NGAYLAPHOADON], [MAPHIEUDANGKY_LOPHOC], [TONGTIEN], [MANV]) VALUES (CAST(N'2021-07-08' AS Date), N'PDK01', 1554.8777, N'NV01')
INSERT [dbo].[HOADON] ([NGAYLAPHOADON], [MAPHIEUDANGKY_LOPHOC], [TONGTIEN], [MANV]) VALUES (CAST(N'2021-07-08' AS Date), N'PDK02', 2015.6226, N'NV02')
INSERT [dbo].[HOADON] ([NGAYLAPHOADON], [MAPHIEUDANGKY_LOPHOC], [TONGTIEN], [MANV]) VALUES (CAST(N'2021-07-08' AS Date), N'PDK03', 1583.0339, N'NV03')
INSERT [dbo].[HOADON] ([NGAYLAPHOADON], [MAPHIEUDANGKY_LOPHOC], [TONGTIEN], [MANV]) VALUES (CAST(N'2021-07-08' AS Date), N'PDK04', 1878.4007, N'NV04')
INSERT [dbo].[HOADON] ([NGAYLAPHOADON], [MAPHIEUDANGKY_LOPHOC], [TONGTIEN], [MANV]) VALUES (CAST(N'2021-07-08' AS Date), N'PDK05', 2090.1398, N'NV05')
GO
INSERT [dbo].[HOCVIEN] ([MAHV], [TENHV], [DOB_HV], [DIACHI_HV], [SDT_HV], [USERNAME_HV]) VALUES (N'HV01', N'Howard Wiggins', CAST(N'2003-02-01' AS Date), N'382 New Blvd.', N'663-984-9648', N'')
INSERT [dbo].[HOCVIEN] ([MAHV], [TENHV], [DOB_HV], [DIACHI_HV], [SDT_HV], [USERNAME_HV]) VALUES (N'HV02', N'Marissa Whitaker', CAST(N'2003-09-23' AS Date), N'652 East Oak Way', N'(904) 054-3519', N'')
INSERT [dbo].[HOCVIEN] ([MAHV], [TENHV], [DOB_HV], [DIACHI_HV], [SDT_HV], [USERNAME_HV]) VALUES (N'HV03', N'Brett Harrell', CAST(N'2001-05-02' AS Date), N'829 Milton Freeway', N'(718) 417-1074', N'')
INSERT [dbo].[HOCVIEN] ([MAHV], [TENHV], [DOB_HV], [DIACHI_HV], [SDT_HV], [USERNAME_HV]) VALUES (N'HV04', N'Brandy Friedman', CAST(N'2003-11-11' AS Date), N'814 Hague Boulevard', N'(833) 318-8675', N'')
INSERT [dbo].[HOCVIEN] ([MAHV], [TENHV], [DOB_HV], [DIACHI_HV], [SDT_HV], [USERNAME_HV]) VALUES (N'HV05', N'Sonja Church', CAST(N'2001-04-27' AS Date), N'544 White Hague Boulevard', N'122-741-3307', N'')
GO
INSERT [dbo].[LICHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [NGAYTHI_MONHOC], [PHONGTHI_MONHOC], [CATHI_MONHOC]) VALUES (N'LH01', N'CK', CAST(N'2021-10-15' AS Date), N'D203', N'Ca 1')
INSERT [dbo].[LICHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [NGAYTHI_MONHOC], [PHONGTHI_MONHOC], [CATHI_MONHOC]) VALUES (N'LH02', N'GK', CAST(N'2021-07-11' AS Date), N'D207', N'Ca 2')
INSERT [dbo].[LICHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [NGAYTHI_MONHOC], [PHONGTHI_MONHOC], [CATHI_MONHOC]) VALUES (N'LH03', N'CK', CAST(N'2021-12-13' AS Date), N'C304', N'Ca 1')
INSERT [dbo].[LICHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [NGAYTHI_MONHOC], [PHONGTHI_MONHOC], [CATHI_MONHOC]) VALUES (N'LH04', N'CK', CAST(N'2021-07-30' AS Date), N'E303', N'Ca 1')
INSERT [dbo].[LICHTHI_MONHOC] ([MALOPHOC], [PHANLOAI], [NGAYTHI_MONHOC], [PHONGTHI_MONHOC], [CATHI_MONHOC]) VALUES (N'LH05', N'GK', CAST(N'2021-10-25' AS Date), N'E205', N'Ca 2')
GO
INSERT [dbo].[LICHTHI_THILAI] ([MAMH], [NGAYTHILAI], [PHONGTHILAI], [CATHILAI]) VALUES (N'MH04', CAST(N'2021-07-09' AS Date), N'F203', N'Ca 1')
INSERT [dbo].[LICHTHI_THILAI] ([MAMH], [NGAYTHILAI], [PHONGTHILAI], [CATHILAI]) VALUES (N'MH05', CAST(N'2021-07-19' AS Date), N'C306', N'Ca 1')
INSERT [dbo].[LICHTHI_THILAI] ([MAMH], [NGAYTHILAI], [PHONGTHILAI], [CATHILAI]) VALUES (N'MH06', CAST(N'2021-07-09' AS Date), N'F203', N'Ca 1')
INSERT [dbo].[LICHTHI_THILAI] ([MAMH], [NGAYTHILAI], [PHONGTHILAI], [CATHILAI]) VALUES (N'MH07', CAST(N'2021-07-19' AS Date), N'C306', N'Ca 1')
INSERT [dbo].[LICHTHI_THILAI] ([MAMH], [NGAYTHILAI], [PHONGTHILAI], [CATHILAI]) VALUES (N'MH08', CAST(N'2021-07-27' AS Date), N'D107', N'Ca 2')
INSERT [dbo].[LICHTHI_THILAI] ([MAMH], [NGAYTHILAI], [PHONGTHILAI], [CATHILAI]) VALUES (N'MH09', CAST(N'2021-07-27' AS Date), N'D107', N'Ca 2')
GO
INSERT [dbo].[LICHTHI_TOTNGHIEP] ([MACTDT], [NGAYTHI_TN], [PHONGTHI_TN], [CATHI_TN]) VALUES (N'CCA21', CAST(N'2022-11-03' AS Date), N'F106', N'Ca 2')
INSERT [dbo].[LICHTHI_TOTNGHIEP] ([MACTDT], [NGAYTHI_TN], [PHONGTHI_TN], [CATHI_TN]) VALUES (N'CCB21', CAST(N'2022-07-16' AS Date), N'D302', N'Ca 1')
INSERT [dbo].[LICHTHI_TOTNGHIEP] ([MACTDT], [NGAYTHI_TN], [PHONGTHI_TN], [CATHI_TN]) VALUES (N'CD1_21', CAST(N'2022-07-16' AS Date), N'D302', N'Ca 1')
INSERT [dbo].[LICHTHI_TOTNGHIEP] ([MACTDT], [NGAYTHI_TN], [PHONGTHI_TN], [CATHI_TN]) VALUES (N'KTV21', CAST(N'2022-11-03' AS Date), N'F106', N'Ca 2')
GO
INSERT [dbo].[LOPHOC] ([MALOP], [NGAYBATDAU], [NGAYKETTHUC], [PHONGHOC], [LICH_HOC], [SISO_TOIDA], [SISO], [MAMH]) VALUES (N'LH01', CAST(N'2021-05-20' AS Date), CAST(N'2021-07-12' AS Date), N'C203', N'Thứ 6', 100, 1, N'MH09')
INSERT [dbo].[LOPHOC] ([MALOP], [NGAYBATDAU], [NGAYKETTHUC], [PHONGHOC], [LICH_HOC], [SISO_TOIDA], [SISO], [MAMH]) VALUES (N'LH02', CAST(N'2021-05-28' AS Date), CAST(N'2021-08-13' AS Date), N'C301', N'Thứ 4', 100, 0, N'MH04')
INSERT [dbo].[LOPHOC] ([MALOP], [NGAYBATDAU], [NGAYKETTHUC], [PHONGHOC], [LICH_HOC], [SISO_TOIDA], [SISO], [MAMH]) VALUES (N'LH03', CAST(N'2021-05-12' AS Date), CAST(N'2021-06-22' AS Date), N'E101', N'Thứ 3', 100, 0, N'MH04')
INSERT [dbo].[LOPHOC] ([MALOP], [NGAYBATDAU], [NGAYKETTHUC], [PHONGHOC], [LICH_HOC], [SISO_TOIDA], [SISO], [MAMH]) VALUES (N'LH04', CAST(N'2021-04-12' AS Date), CAST(N'2021-05-14' AS Date), N'F101', N'Thứ 4', 100, 0, N'MH03')
INSERT [dbo].[LOPHOC] ([MALOP], [NGAYBATDAU], [NGAYKETTHUC], [PHONGHOC], [LICH_HOC], [SISO_TOIDA], [SISO], [MAMH]) VALUES (N'LH05', CAST(N'2021-02-07' AS Date), CAST(N'2021-03-24' AS Date), N'F303', N'Thứ 2', 100, 0, N'MH05')
GO
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH01', N'Cơ sở dữ liệu', 603.0165, N'CĐ')
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH02', N'Phân tích thiết kế', 953.0136, N'KTV')
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH03', N'Vi tích phân 1B', 721.0889, N'CĐ')
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH04', N'Toán rời rạc', 779.4424, N'KTV')
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH05', N'Mạng máy tính', 884.0114, N'KTV')
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH06', N'Nhập môn lập trình', 908.6627, N'KTV')
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH07', N'Kỹ thuật lập trình', 863.1217, N'KTV')
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH08', N'Vật lý đại cương', 779.0806, N'CĐ')
INSERT [dbo].[MONHOC] ([MAMH], [TENMONHOC], [HOCPHI], [LOAI_MH]) VALUES (N'MH09', N'Hệ điều hành', 988.7749, N'KTV')
GO
INSERT [dbo].[NHANVIEN] ([MANV], [TENNV], [LUONG_NV], [DOB_NV], [DIACHI_NV], [CHUCVU_NV], [SDT_NV], [USERNAME_NV]) VALUES (N'NV01', N'Trisha Manning', 1457.9401, CAST(N'1990-05-20' AS Date), N'225 Oak Road', N'KT', N'870', N'')
INSERT [dbo].[NHANVIEN] ([MANV], [TENNV], [LUONG_NV], [DOB_NV], [DIACHI_NV], [CHUCVU_NV], [SDT_NV], [USERNAME_NV]) VALUES (N'NV02', N'Joe Duke', 3784.4881, CAST(N'2001-08-31' AS Date), N'85 Old Freeway', N'KT', N'4', N'')
INSERT [dbo].[NHANVIEN] ([MANV], [TENNV], [LUONG_NV], [DOB_NV], [DIACHI_NV], [CHUCVU_NV], [SDT_NV], [USERNAME_NV]) VALUES (N'NV03', N'Suzanne Casey', 4576.6400, CAST(N'1981-01-22' AS Date), N'680 First Parkway', N'NV', N'945', N'')
INSERT [dbo].[NHANVIEN] ([MANV], [TENNV], [LUONG_NV], [DOB_NV], [DIACHI_NV], [CHUCVU_NV], [SDT_NV], [USERNAME_NV]) VALUES (N'NV04', N'Sonia Osborn', 1660.5744, CAST(N'1982-02-11' AS Date), N'655 Clarendon Avenue', N'KT', N'289', N'')
INSERT [dbo].[NHANVIEN] ([MANV], [TENNV], [LUONG_NV], [DOB_NV], [DIACHI_NV], [CHUCVU_NV], [SDT_NV], [USERNAME_NV]) VALUES (N'NV05', N'Margarita Hayes', 4650.5567, CAST(N'1989-07-28' AS Date), N'767 Rocky Old Drive', N'NV', N'403', N'')
GO
INSERT [dbo].[NHOMHOCPHAN] ([MANHOMHP], [TENNHOM_HP]) VALUES (N'HP01', N'Nhóm chứng chỉ A')
INSERT [dbo].[NHOMHOCPHAN] ([MANHOMHP], [TENNHOM_HP]) VALUES (N'HP02', N'Nhánh 1 chứng chỉ B')
INSERT [dbo].[NHOMHOCPHAN] ([MANHOMHP], [TENNHOM_HP]) VALUES (N'HP03', N'Nhóm học phần 1')
GO
INSERT [dbo].[PHANCONGDAY] ([MALOP], [MAGV]) VALUES (N'LH01', N'GV01')
INSERT [dbo].[PHANCONGDAY] ([MALOP], [MAGV]) VALUES (N'LH02', N'GV02')
INSERT [dbo].[PHANCONGDAY] ([MALOP], [MAGV]) VALUES (N'LH03', N'GV03')
INSERT [dbo].[PHANCONGDAY] ([MALOP], [MAGV]) VALUES (N'LH04', N'GV04')
INSERT [dbo].[PHANCONGDAY] ([MALOP], [MAGV]) VALUES (N'LH05', N'GV05')
GO
INSERT [dbo].[PHIEUDANGKY_LOPHOC] ([MAPHIEUDANGKY], [NGAYDANGKY_LOPHOC], [MAHV]) VALUES (N'PDK01', CAST(N'2020-07-08' AS Date), N'HV02')
INSERT [dbo].[PHIEUDANGKY_LOPHOC] ([MAPHIEUDANGKY], [NGAYDANGKY_LOPHOC], [MAHV]) VALUES (N'PDK02', CAST(N'2020-07-08' AS Date), N'HV03')
INSERT [dbo].[PHIEUDANGKY_LOPHOC] ([MAPHIEUDANGKY], [NGAYDANGKY_LOPHOC], [MAHV]) VALUES (N'PDK03', CAST(N'2020-07-08' AS Date), N'HV05')
INSERT [dbo].[PHIEUDANGKY_LOPHOC] ([MAPHIEUDANGKY], [NGAYDANGKY_LOPHOC], [MAHV]) VALUES (N'PDK04', CAST(N'2020-07-08' AS Date), N'HV01')
INSERT [dbo].[PHIEUDANGKY_LOPHOC] ([MAPHIEUDANGKY], [NGAYDANGKY_LOPHOC], [MAHV]) VALUES (N'PDK05', CAST(N'2020-07-08' AS Date), N'HV04')
INSERT [dbo].[PHIEUDANGKY_LOPHOC] ([MAPHIEUDANGKY], [NGAYDANGKY_LOPHOC], [MAHV]) VALUES (N'PDK06', CAST(N'2021-07-09' AS Date), N'HV04')
GO
INSERT [dbo].[USERS] ([USERNAME], [PASSWORD], [TYPE]) VALUES (N'NV01', N'1234', N'NV')
INSERT [dbo].[USERS] ([USERNAME], [PASSWORD], [TYPE]) VALUES (N'HV01', N'1234', N'HV')
INSERT [dbo].[USERS] ([USERNAME], [PASSWORD], [TYPE]) VALUES (N'HV02', N'1234', N'HV')
INSERT [dbo].[USERS] ([USERNAME], [PASSWORD], [TYPE]) VALUES (N'NV02', N'1234', N'NV')
INSERT [dbo].[USERS] ([USERNAME], [PASSWORD], [TYPE]) VALUES (N'HV04', N'1234', N'HV')

ALTER TABLE dbo.BANGTOTNGHIEP
ADD
 CONSTRAINT FK_TN_DT
 FOREIGN KEY (MACTDT)
 REFERENCES dbo.CT_DAOTAO,

 CONSTRAINT FK_TN_HV
 FOREIGN KEY (MAHV)
 REFERENCES dbo.HOCVIEN

ALTER TABLE dbo.GHIDANH
ADD
	CONSTRAINT FK_GD_DT
	FOREIGN KEY (MACTDT)
	REFERENCES dbo.CT_DAOTAO,

	CONSTRAINT FK_DT_HV
	FOREIGN KEY (MAHV)
	REFERENCES dbo.HOCVIEN

ALTER TABLE dbo.LICHTHI_TOTNGHIEP
ADD
	CONSTRAINT FK_LTTN_DT
	FOREIGN KEY (MACTDT)
	REFERENCES dbo.CT_DAOTAO

ALTER TABLE dbo.DANHSACHTHI_TN 
ADD 
	CONSTRAINT FK_DSTN_LTTN
	FOREIGN KEY(MACTDT, NGAYTHI_TN, CATHI_TN, PHONGTHI_TN)
	REFERENCES dbo.LICHTHI_TOTNGHIEP,

	CONSTRAINT FK_DSTN_HV
	FOREIGN KEY (MAHV)
	REFERENCES dbo.HOCVIEN

ALTER TABLE dbo.CHITIET_NHOMHP
ADD
	CONSTRAINT FK_CTHP_HP
	FOREIGN KEY (MAHP)
	REFERENCES dbo.NHOMHOCPHAN,

	CONSTRAINT FK_CTHP_MH
	FOREIGN KEY (MAMH)
	REFERENCES dbo.MONHOC

ALTER TABLE dbo.LOPHOC
ADD 
	CONSTRAINT FK_LH_MH
	FOREIGN KEY (MAMH)
	REFERENCES dbo.MONHOC

ALTER TABLE dbo.PHANCONGDAY
ADD 
	CONSTRAINT FK_PC_LH
	FOREIGN KEY(MALOP)
	REFERENCES dbo.LOPHOC,

	CONSTRAINT FK_PC_GV
	FOREIGN KEY (MAGV)
	REFERENCES dbo.GIAOVIEN

ALTER TABLE dbo.CHITIET_DANGKYLOPHOC
ADD
	CONSTRAINT FK_DKHP_LH
	FOREIGN KEY (MALOPHOC)
	REFERENCES dbo.LOPHOC,

	CONSTRAINT FK_CT_PDK
	FOREIGN KEY (MAPHIEUDANKY_LOPHOC)
	REFERENCES dbo.PHIEUDANGKY_LOPHOC

ALTER TABLE dbo.GIAYCHUNGNHAN
ADD
	CONSTRAINT FK_GCN_HP
	FOREIGN KEY (MAHP)
	REFERENCES dbo.NHOMHOCPHAN,

	CONSTRAINT FK_GCN_HV
	FOREIGN KEY (MAHV)
	REFERENCES dbo.HOCVIEN

ALTER TABLE dbo.LICHTHI_THILAI
ADD 
	CONSTRAINT FK_TL_MH
	FOREIGN KEY (MAMH)
	REFERENCES dbo.MONHOC

ALTER TABLE dbo.DANHSACH_THILAI
ADD 
	CONSTRAINT FK_DSTL_MH
	FOREIGN KEY (MAMH)
	REFERENCES dbo.MONHOC,

	CONSTRAINT FK_DS_LT_TL
	FOREIGN KEY (MAMH, NGAYTHILAI, CATHILAI, PHONGTHILAI)
	REFERENCES dbo.LICHTHI_THILAI

ALTER TABLE dbo.DANHSACH_THILAI
ADD 
	CONSTRAINT FK_DSMH_HV
	FOREIGN KEY (MAHV)
	REFERENCES dbo.HOCVIEN

ALTER TABLE dbo.LICHTHI_MONHOC
ADD		
	CONSTRAINT FK_LT_LH
	FOREIGN KEY (MALOPHOC)
	REFERENCES dbo.LOPHOC

ALTER TABLE dbo.DANHSACHTHI_MONHOC
ADD		
	CONSTRAINT FK_DSLT_LH
	FOREIGN KEY (MALOPHOC, PHANLOAI)
	REFERENCES dbo.LICHTHI_MONHOC, 

	CONSTRAINT FK_DSTL_HV
	FOREIGN KEY (MAHV)
	REFERENCES dbo.HOCVIEN

ALTER TABLE dbo.HOADON
ADD
	CONSTRAINT FK_HD_NV
	FOREIGN KEY (MANV)
	REFERENCES dbo.NHANVIEN,

	CONSTRAINT FK_HD_DKHP
	FOREIGN KEY (MAPHIEUDANGKY_LOPHOC)
	REFERENCES dbo.PHIEUDANGKY_LOPHOC

ALTER TABLE dbo.PHIEUDANGKY_LOPHOC
ADD 
	CONSTRAINT FK_DKHP_HV
	FOREIGN KEY (MAHV)
	REFERENCES dbo.HOCVIEN


GO
CREATE TRIGGER FK_DSGT_MANV
ON dbo.DANHSACH_GACTHI
AFTER INSERT,DELETE
AS
DECLARE
	@CURRENT_MANV VARCHAR (50) = NULL
BEGIN
	SELECT @CURRENT_MANV = dbo.NHANVIEN.MANV 
	FROM dbo.NHANVIEN, Inserted
	WHERE dbo.NHANVIEN.MANV = Inserted.MANV

	IF (@CURRENT_MANV IS NULL)
	BEGIN
		SELECT @CURRENT_MANV = dbo.GIAOVIEN.MAGV
		FROM dbo.GIAOVIEN , Inserted
		WHERE dbo.GIAOVIEN.MAGV = Inserted.MANV

		IF (@CURRENT_MANV IS NULL)
			BEGIN
				RAISERROR (N'MANV KHÔNG TỒN TẠI', 16,1)
				ROLLBACK
			END
	END
END


GO
CREATE TRIGGER FK_DSGT_CATHI
ON dbo.DANHSACH_GACTHI
FOR INSERT, UPDATE
AS
BEGIN
	IF NOT EXISTS (SELECT  *
				   FROM dbo.LICHTHI_MONHOC MH, Inserted
				   WHERE  Inserted.CATHI = MH.CATHI_MONHOC 
					AND Inserted.PHONGTHI = MH.PHONGTHI_MONHOC 
					AND Inserted.NGAYTHI = MH.NGAYTHI_MONHOC)
	BEGIN
		IF NOT EXISTS (SELECT  *
					   FROM dbo.LICHTHI_THILAI MH, Inserted
					   WHERE  Inserted.CATHI = MH.CATHILAI 
						AND Inserted.PHONGTHI = MH.PHONGTHILAI 
						AND Inserted.NGAYTHI = MH.NGAYTHILAI)
		 BEGIN
			IF NOT EXISTS (SELECT *
						   FROM dbo.LICHTHI_TOTNGHIEP MH, Inserted
						   WHERE  Inserted.CATHI = MH.CATHI_TN
							AND Inserted.PHONGTHI = MH.PHONGTHI_TN 
							AND Inserted.NGAYTHI = MH.NGAYTHI_TN)
			ROLLBACK
		 END
	END
END

USE QLTH

GO
CREATE TRIGGER NV_LUONG
ON dbo.NHANVIEN
FOR INSERT, UPDATE
AS
DECLARE
	@I_LUONG MONEY
BEGIN 
	SELECT @I_LUONG = Inserted.LUONG_NV
	FROM Inserted

	IF (@I_LUONG <= 0)
	BEGIN
		RAISERROR (N'LƯƠNG PHẢI LÀ MỘT SỐ NGUYÊN DƯƠNG', 16,1)
		ROLLBACK
	END
	COMMIT
END

GO
CREATE TRIGGER GV_LUONG
ON dbo.GIAOVIEN
FOR INSERT, UPDATE
AS
DECLARE
	@I_LUONG MONEY
BEGIN 
	SELECT @I_LUONG = Inserted.LUONG_GV
	FROM Inserted

	IF (@I_LUONG <= 0)
	BEGIN
		RAISERROR (N'LƯƠNG PHẢI LÀ MỘT SỐ NGUYÊN DƯƠNG', 16,1)
		ROLLBACK
	END
	COMMIT
END

GO
CREATE TRIGGER DIEMTHI_TN
ON dbo.DANHSACHTHI_TN
FOR INSERT, UPDATE
AS
BEGIN
	IF ((SELECT Inserted.DIEMTHI_TN FROM InserteD) < 0 OR (SELECT Inserted.DIEMTHI_TN FROM InserteD) > 10) 
		BEGIN
			RAISERROR (N'ĐIỂM KHÔNG HỢP LỆ',16,1)
			ROLLBACK
		END
	COMMIT
END

GO
CREATE TRIGGER MONHOC_HP
ON dbo.MONHOC
FOR INSERT, UPDATE
AS 
BEGIN
	IF ( (SELECT Inserted.HOCPHI FROM Inserted) <= 0)
	BEGIN
	    RAISERROR (N'HỌC PHÍ PHẢI LÀ SỐ NGUYÊN DƯƠNG', 16, 1)
		ROLLBACK
	END
	COMMIT
END

GO
CREATE TRIGGER SISOTOIDA
ON dbo.LOPHOC
FOR INSERT, UPDATE
AS
BEGIN
	IF ((SELECT Inserted.SISO_TOIDA FROM Inserted) <= 0)
		BEGIN
			RAISERROR (N'SỈ SỐ TỐI ĐA PHẢI LÀ MỘT SỐ NGUYÊN DƯƠNG', 16,1)
			ROLLBACK
		END
	COMMIT
END

GO
/*
DROP TRIGGER ADD_DKHP
ON dbo.CHITIET_DANGKYLOPHOC
FOR INSERT
AS
DECLARE
	@I_MALOP VARCHAR(50),
	@CURRENT INT,
	@MAX INT
BEGIN
	SELECT @I_MALOP = Inserted.MALOPHOC
	FROM Inserted

	SELECT @CURRENT = dbo.LOPHOC.SISO, @MAX = dbo.LOPHOC.SISO_TOIDA
	FROM dbo.LOPHOC

	IF (@CURRENT = @MAX)
	BEGIN
	    RAISERROR (N'LỚP ĐẦY',16, 1)
		ROLLBACK
	END
	ELSE
		BEGIN
			UPDATE dbo.LOPHOC
			SET SISO = SISO + 1
			WHERE MALOP = @I_MALOP
			COMMIT
		END
END

GO

DROP TRIGGER DROP_DKHP
ON dbo.CHITIET_DANGKYLOPHOC
FOR DELETE
AS
DECLARE
	@I_MALOP VARCHAR(50)
BEGIN
	SELECT @I_MALOP = Deleted.MALOPHOC

	FROM Deleted

	UPDATE dbo.LOPHOC
	SET SISO = SISO - 1
	WHERE MALOP = @I_MALOP
	COMMIT
END
*/

GO
CREATE TRIGGER HOADON_IUD
ON dbo.HOADON
FOR INSERT, UPDATE
AS
DECLARE	
	@CHUC_VU NVARCHAR(50)
BEGIN
	SELECT @CHUC_VU = NV.CHUCVU_NV
	FROM Inserted I JOIN dbo.NHANVIEN NV ON I.MANV = NV.MANV 

	IF(@CHUC_VU <> N'KẾ TOÁN' AND @CHUC_VU IS NOT NULL)
	BEGIN
		 RAISERROR (N'CHỈ CÓ NHÂN VIÊN KẾ TOÁN MỚI ĐƯỢC THỰC HIỆN', 16, 1)
		 ROLLBACK
	END
END

GO
CREATE TRIGGER HOADON_TONG_TIEN
ON dbo.HOADON
FOR INSERT, UPDATE
AS
BEGIN
    IF((SELECT Inserted.TONGTIEN FROM Inserted) <= 0)
	BEGIN
		RAISERROR (N'TỔNG TIỀN PHẢI LÀ MỘT SỐ NGUYÊN DƯƠNG',16, 1)
		ROLLBACK
	END
	COMMIT
END

GO
CREATE TRIGGER DTL
ON dbo.DANHSACH_THILAI
FOR INSERT, UPDATE
AS
BEGIN
	IF((SELECT Inserted.DIEMTHILAI FROM Inserted) < 0 OR (SELECT Inserted.DIEMTHILAI FROM Inserted) > 10)
	BEGIN
	    RAISERROR (N'ĐIỂM KHÔNG HỢP LỆ',16,1)
		ROLLBACK
	END
END

GO
CREATE TRIGGER DMH
ON dbo.DANHSACHTHI_MONHOC
FOR INSERT, UPDATE
AS
BEGIN
	IF((SELECT Inserted.DIEMTHI_MH FROM Inserted) < 0 OR (SELECT Inserted.DIEMTHI_MH FROM Inserted) > 10)
	BEGIN
	    RAISERROR (N'ĐIỂM KHÔNG HỢP LỆ',16,1)
		ROLLBACK
	END
END


GO
CREATE PROC SHOWCLASS 
@ID VARCHAR(50), @program NVARCHAR(50) 
AS
	IF(@program LIKE 'KTV%')
		SET @program = 'KTV'
	ELSE
    BEGIN
		IF (@program LIKE 'CD%')
		SET @program = 'CD'
	END
	
	SELECT MH.MAMH, MH.TENMONHOC, LH.MALOP, lh.NGAYBATDAU, LH.PHONGHOC, LH.LICH_HOC, LH.SISO_TOIDA, LH.SISO
	FROM dbo.LOPHOC LH JOIN dbo.MONHOC MH ON LH.MAMH = MH.MAMH
	WHERE  LH.NGAYBATDAU > GETDATE() AND LOAI_MH LIKE @program AND MH.MAMH IN (
	SELECT MAMH
	FROM dbo.LOPHOC
	WHERE MAMH NOT IN (SELECT MAMH
						 FROM dbo.CHITIET_DANGKYLOPHOC ctdk join dbo.LOPHOC lh ON ctdk.MALOPHOC = lh.MALOP
					     WHERE ctdk.KETQUAMONHOC = 'TRUE' AND ctdk.MAPHIEUDANKY_LOPHOC IN (SELECT MAPHIEUDANGKY
																						  FROM dbo.PHIEUDANGKY_LOPHOC
																						  WHERE MAHV = @ID )))

GO
CREATE PROC REGIS_DETAIL
@regisID VARCHAR(50)
AS
	SELECT MH.MAMH, MH.TENMONHOC, LH.MALOP, LH.NGAYBATDAU, LH.PHONGHOC, LH.LICH_HOC 
	FROM (dbo.CHITIET_DANGKYLOPHOC CT JOIN dbo.LOPHOC LH ON CT.MALOPHOC = LH.MALOP)
		JOIN dbo.MONHOC MH ON LH.MAMH = MH.MAMH
	WHERE CT.MAPHIEUDANKY_LOPHOC = @regisID


GO
CREATE PROC CREATE_REGIS
@REGIS_ID VARCHAR(50), @STUDENT_ID VARCHAR(50)
AS
	INSERT INTO PHIEUDANGKY_LOPHOC
    VALUES(@REGIS_ID,  GETDATE(), @STUDENT_ID)


GO
CREATE PROC ENROLL_CLASS
@CLASS VARCHAR(50), @ID VARCHAR(50)
AS
	
	INSERT dbo.CHITIET_DANGKYLOPHOC
	VALUES(@CLASS, @ID, 0) 
	
	UPDATE dbo.LOPHOC
	SET SISO = SISO + 1
	WHERE MALOP = @CLASS;
	

GO
CREATE PROC CANCEL_CLASS
@ID VARCHAR(50), @CLASS VARCHAR(50)
AS
	DELETE FROM dbo.CHITIET_DANGKYLOPHOC
	WHERE MALOPHOC = @CLASS AND MAPHIEUDANKY_LOPHOC = @ID

	UPDATE dbo.LOPHOC
	SET SISO = SISO - 1
	WHERE MALOP = @CLASS;

GO
CREATE PROC CHECK_ENROLL
@CLASS VARCHAR(50), @ID VARCHAR(50)
AS
SELECT COUNT(*) AS ketqua
FROM CHITIET_DANGKYLOPHOC
WHERE MALOPHOC = @CLASS AND MAPHIEUDANKY_LOPHOC = @ID

GO 
CREATE PROC CHECK_SUB
@ID VARCHAR(50), @SUB VARCHAR(50)
AS
	SELECT COUNT(*)  AS ketqua
	FROM(CHITIET_DANGKYLOPHOC ct JOIN LOPHOC LH ON ct.MALOPHOC = LH.MALOP)
         JOIN MONHOC mh ON LH.MAMH = mh.MAMH
    WHERE ct.MAPHIEUDANKY_LOPHOC = @ID AND MH.MAMH = @SUB






